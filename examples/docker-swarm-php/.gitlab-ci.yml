---
# @Description Install PHP packages
composer-install:
  stage: .pre
  image: composer
  needs: [ ]
  artifacts:
    paths: [ vendor/ ]
  script:
    - composer install --no-progress

# @Description Find PHP Code standard issues
php-cs-fixer-dry-run:
  stage: test
  image: php
  rules:
    - { if: $GITLAB_CI == 'false', allow_failure: true, when: on_success }
    - { if: $GITLAB_CI == 'true', allow_failure: false, when: on_success}
  needs: [ composer-install ]
  script:
    - vendor/bin/php-cs-fixer fix --dry-run --diff

# @Description Find outdated PHP packages
composer-outdated:
  stage: test
  needs: [ composer-install ]
  allow_failure: true
  script:
    - composer outdated --strict --direct
    - echo "PHP packages are up to date"
